# TodoList v1.7.0 更新日志

## 🚀 版本发布日期
2025年7月24日

## ✨ 全新功能

### 📋 长按复制任务
- **功能描述**：用户现在可以长按任务卡片快速复制任务
- **操作方式**：长按任务卡片 → 确认复制 → 自动创建副本
- **智能处理**：
  - 自动重置任务ID，避免数据库冲突
  - 标题自动添加"(副本)"标识
  - 重置完成状态为未完成
  - 清除提醒设置，避免重复通知
  - 完整复制所有子任务和附件

### 🎯 复制反馈优化
- **成功提示**：复制完成后显示包含任务名称的成功消息
- **失败处理**：复制失败时显示清晰的错误提示
- **用户体验**：操作反馈更加直观和友好

## 🛠️ 重要修复

### 💾 数据库约束修复
- **问题描述**：复制任务时出现主键约束失败错误
- **根本原因**：`copyWith`方法的`id ?? this.id`逻辑导致ID重复
- **解决方案**：
  - 重构复制逻辑，使用直接实例化而非`copyWith`
  - 确保Todo、Subtask、Attachment的ID正确重置
  - 修复子任务和附件复制时的主键冲突

### 📝 Markdown预览修复
- **问题描述**：编辑模式下Markdown预览显示空白或旧内容
- **根本原因**：预览组件使用`widget.text`而非`_controller.text`
- **解决方案**：
  - 修改`_buildPreview()`方法使用控制器文本
  - 优化文本变化监听，确保实时更新
  - 预览现在能实时显示用户正在输入的内容

### 🔧 滑动删除优化
- **问题描述**：向左滑动删除任务时出现两个确认框
- **根本原因**：TodoCard和主屏幕都有删除确认逻辑
- **解决方案**：
  - 移除TodoCard中的重复确认框
  - 统一由主屏幕处理删除确认
  - 用户体验更加一致和流畅

## 🔧 技术改进

### 🏗️ 代码质量提升
- **架构优化**：重构复制算法，使用更可靠的实例化方法
- **错误处理**：增强数据库操作的错误处理和日志记录
- **代码清理**：移除未使用的方法和重复代码
- **性能优化**：减少不必要的状态更新和重建

### 📊 调试能力增强
- **日志完善**：添加详细的复制操作日志
- **错误追踪**：提供更精确的错误信息和堆栈跟踪
- **用户反馈**：改进错误消息的用户友好性

## 🎨 用户体验改善

### 🖱️ 交互优化
- **手势操作**：长按复制手势直观易用
- **视觉反馈**：操作过程中提供清晰的视觉提示
- **错误恢复**：失败操作不会影响应用稳定性

### 📱 界面更新
- **版本显示**：应用关于页面更新至v1.7.0
- **功能列表**：新增复制功能和Markdown支持的展示
- **用户指南**：更新功能特点描述

## 🚧 已知问题
- 无已知重大问题

## 📋 升级说明
- 本次更新向后兼容，不会影响现有数据
- 复制功能为新增功能，不影响现有任务操作
- 建议用户体验新的长按复制功能

## 🔮 下一步计划
- 考虑添加批量操作功能
- 优化大量任务时的性能表现
- 继续改进用户体验和界面设计

---

**开发团队**：fxlqwq  
**项目地址**：https://github.com/fxlqwq/ToDoList-Notice-Flutter
