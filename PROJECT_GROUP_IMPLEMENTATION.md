# ToDoList 应用项目组和数据备份功能实现总结

## 已完成的功能

### 1. 应用签名配置
- ✅ 创建了应用签名密钥 (`android/app/keystore/app-release-key.jks`)
- ✅ 配置了签名属性文件 (`android/key.properties`)
- ✅ 更新了 `android/app/build.gradle` 以使用自定义签名
- ✅ 设置了密码和别名：
  - 存储密码: `todolist123`
  - 密钥密码: `todolist123`
  - 别名: `upload`

### 2. 项目组（主任务）功能
- ✅ 创建了 `ProjectGroup` 模型 (`lib/models/project_group.dart`)
- ✅ 更新了 `Todo` 模型以支持项目组关联
- ✅ 更新了数据库版本到 v3，添加了项目组表
- ✅ 创建了项目组管理页面 (`lib/screens/project_group_manager_screen.dart`)
  - 显示所有项目组及其统计信息
  - 支持创建、编辑、删除项目组
  - 颜色选择器支持
  - 防止删除默认项目组
- ✅ 更新了主页面以支持项目组切换
  - 顶部标题显示当前项目组名称
  - 点击可弹出项目组选择器
  - 右上角菜单添加项目组管理入口

### 3. 数据导入导出功能
- ✅ 创建了完整的数据导出服务 (`lib/services/data_export_service.dart`)
- ✅ 创建了数据备份管理页面 (`lib/screens/data_backup_screen.dart`)
- ✅ 支持的功能：
  - **全部数据导出**: 导出所有项目组和任务
  - **单个项目组导出**: 导出特定项目组的数据
  - **数据导入**: 支持导入完整备份或项目组数据
  - **备份文件管理**: 查看、删除本地备份文件
- ✅ 备份文件存储在 `Downloads/ToDoList` 目录
- ✅ 支持权限管理和错误处理

### 4. 任务编辑页面更新
- ✅ 添加了项目组选择器到任务创建/编辑页面
- ✅ 支持为任务指定项目组
- ✅ 新任务默认分配到当前选中的项目组

### 5. TodoProvider 更新
- ✅ 添加了项目组管理功能
- ✅ 支持按项目组筛选任务
- ✅ 默认项目组显示所有任务
- ✅ 项目组切换自动刷新任务列表

### 6. 数据库架构更新
- ✅ 添加了 `project_groups` 表
- ✅ 为 `todos` 表添加了 `projectGroupId` 外键
- ✅ 自动创建默认项目组（"全部任务"）
- ✅ 支持数据库版本升级和迁移

### 7. UI/UX 改进
- ✅ 在主页面菜单中添加了：
  - 项目组管理
  - 数据备份
- ✅ 项目组颜色编码支持
- ✅ 统计信息显示（总任务、已完成、未完成）
- ✅ 响应式设计和错误处理

## 技术特点

### 安全性
- 自定义应用签名确保更新兼容性
- 权限管理确保安全的文件访问

### 数据完整性
- JSON 格式导出包含完整的任务、子任务、附件数据
- 数据库外键约束确保数据一致性
- 错误处理和回滚机制

### 用户体验
- 直观的项目组切换界面
- 拖拽式文件选择
- 实时统计信息更新
- 优雅的错误提示

### 可扩展性
- 模块化的服务架构
- 清晰的数据模型分离
- 易于添加新的导出格式或数据源

## 文件结构
```
lib/
├── models/
│   ├── project_group.dart          # 项目组模型
│   └── todo.dart                   # 更新的任务模型
├── screens/
│   ├── project_group_manager_screen.dart  # 项目组管理页面
│   ├── data_backup_screen.dart            # 数据备份页面
│   ├── home_screen.dart                   # 更新的主页面
│   └── add_edit_todo_screen.dart          # 更新的任务编辑页面
├── services/
│   ├── data_export_service.dart           # 数据导入导出服务
│   ├── database_service.dart              # 更新的数据库服务
│   └── todo_provider.dart                 # 更新的状态管理
android/
├── key.properties                         # 签名配置
└── app/
    ├── build.gradle                       # 更新的构建配置
    └── keystore/
        └── app-release-key.jks            # 应用签名文件
```

## 使用说明

### 项目组管理
1. 点击主页面右上角菜单 → "项目组管理"
2. 可以创建、编辑、删除项目组
3. 每个项目组可以设置名称、描述和颜色
4. 默认项目组不能删除，显示所有任务

### 项目组切换
1. 在主页面点击顶部的项目组名称
2. 从弹出菜单中选择要切换的项目组
3. 任务列表会自动更新为该项目组的任务

### 数据备份
1. 点击主页面右上角菜单 → "数据备份"
2. **导出**：选择"导出全部数据"或单个项目组导出
3. **导入**：选择"导入全部数据"或"导入项目数据"
4. **管理**：查看和删除备份文件

### 任务分组
1. 创建或编辑任务时，可以选择项目组
2. 新任务默认分配到当前选中的项目组
3. 可以随时修改任务的项目组归属

## 构建和部署
```bash
# 构建发布版本
flutter build apk --release

# 构建调试版本
flutter build apk --debug

# 生成的APK位置
build/app/outputs/flutter-apk/app-release.apk
```

应用现在具有完整的项目组管理和数据备份功能，支持用户更好地组织和管理他们的任务，同时确保数据的安全备份和恢复。
