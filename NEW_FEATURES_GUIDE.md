# Flutter ToDoList 新功能说明

## 版本 1.5.5 新增功能

### 1. 子任务/检查清单功能

#### 主要特性：
- 为每个主任务添加多个子任务
- 子任务可以独立标记完成/未完成
- 显示子任务完成进度（如：3/5 完成）
- 支持子任务的添加、编辑和删除
- 任务卡片显示完成进度条

#### 使用方法：
1. 在添加/编辑任务页面，找到"子任务"部分
2. 点击"Add subtask"按钮添加子任务
3. 输入子任务标题并确认
4. 在主界面的任务卡片中可以看到子任务进度指示器
5. 展开任务详情可查看所有子任务状态

#### 进度计算：
- 主任务权重：30%
- 子任务权重：70%
- 完成进度 = (主任务完成状态 × 30%) + (已完成子任务数/总子任务数 × 70%)

### 2. 任务附件功能

#### 支持的附件类型：
- **图片附件**：支持从相册选择或拍照
- **语音备忘录**：支持录音和播放
- **文本笔记**：支持添加文本备注

#### 使用方法：
1. 在添加/编辑任务页面，找到"附件"部分
2. 点击相应的附件类型按钮：
   - 📷 图片：选择从相册选择或拍照
   - 🎤 语音：点击开始录音，再次点击停止
   - 📝 文本：输入标题和内容
3. 附件会自动保存到应用私有目录
4. 在任务卡片上会显示附件数量指示器

#### 附件管理：
- 附件文件存储在应用私有目录
- 支持附件预览（图片、文本）
- 支持语音附件播放
- 支持附件删除（会同时删除文件）

### 3. Markdown 支持功能

#### 主要特性：
- 任务描述支持 Markdown 格式
- 实时预览和编辑模式切换
- 丰富的格式化工具栏
- 支持 GitHub 风格的 Markdown

#### 支持的 Markdown 语法：
- **粗体文本**：`**文本**`
- *斜体文本*：`*文本*`
- ~~删除线~~：`~~文本~~`
- 标题：`## 标题`
- 列表：`- 项目` 或 `1. 项目`
- 引用：`> 引用内容`
- 行内代码：`` `代码` ``
- 代码块：`` ``` ``

#### 使用方法：
1. 在添加/编辑任务时，打开任务描述的 Markdown 开关
2. 使用工具栏快速插入格式
3. 在编辑模式和预览模式之间切换
4. 在主界面会根据设置渲染 Markdown 内容

### 4. 界面增强

#### 任务卡片改进：
- 显示子任务完成进度条
- 显示附件数量指示器
- 支持 Markdown 内容渲染
- 更丰富的视觉反馈

#### 数据库升级：
- 支持子任务表（subtasks）
- 支持附件表（attachments）
- 自动数据库版本升级
- 数据完整性保护

### 5. 权限要求

#### 新增权限：
- 录音权限：`RECORD_AUDIO`
- 相机权限：`CAMERA`
- 媒体访问权限：`READ_MEDIA_IMAGES`, `READ_MEDIA_AUDIO`
- 音频设置权限：`MODIFY_AUDIO_SETTINGS`

#### Android 要求：
- 最低 API 级别：24 (Android 7.0)
- 编译 SDK 版本：35
- 支持 Android 7.0 及以上版本

### 6. 技术实现

#### 新增依赖包：
- `flutter_markdown: ^0.7.3+1` - Markdown 渲染
- `markdown: ^7.2.2` - Markdown 解析
- `file_picker: ^8.1.2` - 文件选择
- `image_picker: ^1.1.2` - 图片选择/拍照
- `flutter_sound: ^9.11.2` - 音频录制/播放
- `path_provider: ^2.1.4` - 文件路径管理
- `uuid: ^4.5.1` - 唯一标识符生成

#### 核心服务：
- `AttachmentService` - 附件管理服务
- 增强的 `DatabaseService` - 支持子任务和附件
- 更新的 `TodoProvider` - 支持复合数据加载

### 7. 使用建议

#### 性能优化：
- 图片自动压缩到合理尺寸
- 音频使用高效的 AAC 格式
- 数据库查询优化，支持关联数据加载

#### 最佳实践：
- 合理使用子任务，避免层级过深
- 及时清理不需要的附件
- Markdown 内容保持简洁清晰
- 定期备份重要任务数据

### 8. 故障排除

#### 常见问题：
1. **权限被拒绝**：到系统设置中手动授权
2. **录音无声音**：检查麦克风权限和音量设置
3. **图片无法显示**：检查存储权限和文件路径
4. **Markdown 不渲染**：确认 Markdown 开关已打开

#### 日志查看：
- 在 Flutter 控制台查看详细错误信息
- 检查文件系统权限和存储空间
- 确认数据库升级是否成功

## 总结

这次更新为 ToDoList 应用添加了三个重要功能：

1. **子任务系统**：让复杂任务管理更加细致和可控
2. **附件支持**：让任务信息更加完整和丰富
3. **Markdown 支持**：让任务描述更加灵活和美观

这些功能大大增强了应用的实用性和用户体验，使其能够处理更复杂的任务管理需求。
